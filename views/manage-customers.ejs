<%- include ('layouts/header') %>

<body>
  <main class="table">
      <section class="table__header">
          <h1>Customer's Status</h1>
          <div class="input-group">
            <input id="search" type="text" placeholder="Search Data.." autocomplete="off">
          </div>
          <a href="/admin/register-customer-manager" class="border-shadow">
            <span class="text-gradient">New Customer<i class="fas fa-customer"></i></span>
          </a>
      </section>
      <section class="table__body">
        <table>
            <thead>
              <tr>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Brand Name</th>
                  <th>Mobile Number</th>
                  <th>Gender</th>
                  <th>Invoice Price</th>
                  <th>Purchase Date</th>
                  <th>Vip Number</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="results">
                
                  
              </tbody>
          </table>
        </section>
    </main>
  </body>
    <script type="text/javascript">
      const searchInput = document.querySelector('#search');
      const results_body = document.querySelector('#results');

      load_data();

      function load_data(query = '')
      {
        const request = new XMLHttpRequest();

        request.open('GET', '/search?q=${query}');

        request.onload = () => {


          const results = JSON.parse(request.reponseText);

          let html = '';

          if(result.length >0)
          {
             results.forEach(result => {
              html += `
                <tr>
		              <td><a href="/admin/customer/`+result.customer.id+`">
                    `+result.customer.name+`</a></td>
                  <td> `+result.customer.email+` </td>
                  <td> `+result.customer.brandname+` </td>
                  <td> `+result.customer.phone+`</td>
                  <td> `+result.customer.gender+` </td>
                  <td> `+result.customer.price+`</td>
                  <td> `+result.customer.date+` </td>
                  <td> `+result.customer.vipnumber+` </td>
                  <td>
                  <a href="/admin/update-customer/`+ result.customer.id+`" class="btn border-shadow update">
                      <span class="text-gradient"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span>
                  </a>
                    <a href="/admin/delete-customer/`+ result.customer.id+`" class="btn border-shadow update">
                    <span class="text-gradient" ><i class="fas fa-times" ></i></span>
                  </a>
                  </form>
                </td>
                </tr>
                `
              });
          }
          else 
          {
            html +=`
            <tr>
              <td colspan = "5" class="text-center">No data Found</td>
            </tr>
            `
            
          }

          results_body.innerHTML = html;
        };
        
        request.send();
      }
         
      searchInput.addEventListener('input', () => {
        const query = searchInput.value;

        load_data(query);
      });


    </script>

<%- include ('layouts/footer') %>


